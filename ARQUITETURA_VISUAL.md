# ๐จ ARQUITETURA VISUAL DO SISTEMA

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     SISTEMA CRIADOR DE HORรRIO DE AULA ESCOLAR              โ
โ                      + SISTEMA DE COMUNICAรรO INTEGRADO                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโ FRONTEND (React + TypeScript) โโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ       โ
โ  โ Notificaรงรตesโ  โ  Mensagens  โ  โ  Horรกrio    โ  โ   Painel    โ       โ
โ  โ   Settings  โ  โ  ao Vivo    โ  โ Emergencial โ  โ     TV      โ       โ
โ  โ             โ  โ             โ  โ             โ  โ             โ       โ
โ  โ  ๐ Config  โ  โ  ๐ฌ Instant โ  โ  โก Urgente โ  โ  ๐บ Display โ       โ
โ  โ  Lembretes  โ  โ  Individual โ  โ  Substitui  โ  โ  Aeroporto  โ       โ
โ  โ  Templates  โ  โ  Coletivo   โ  โ  Professor  โ  โ  Real-Time  โ       โ
โ  โ  Histรณrico  โ  โ  Templates  โ  โ  Notifica   โ  โ  Auto-Ref   โ       โ
โ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ       โ
โ         โ                โ                โ                โ               โ
โโโโโโโโโโโผโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
          โ                โ                โ                โ
          โผ                โผ                โผ                โผ
โโโโโโโโโโโโโโโโโโโโโโโโ API REST (Express) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ                     ROTAS (10 endpoints)                            โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค     โ
โ  โ  /api/notifications                                                 โ     โ
โ  โ    GET    /           - Listar notificaรงรตes (filtros)              โ     โ
โ  โ    POST   /           - Criar notificaรงรฃo manual                   โ     โ
โ  โ    GET    /config     - Obter configuraรงรตes                        โ     โ
โ  โ    PUT    /config     - Atualizar configuraรงรตes                    โ     โ
โ  โ    POST   /generate-reminders - Gerar lembretes em massa           โ     โ
โ  โ    DELETE /:id        - Cancelar notificaรงรฃo                       โ     โ
โ  โ                                                                     โ     โ
โ  โ  /api/live-messages                                                 โ     โ
โ  โ    GET    /teachers   - Listar professores ativos                  โ     โ
โ  โ    POST   /send       - Enviar mensagem instantรขnea                โ     โ
โ  โ    POST   /alert-vacant - Alertar sobre horรกrio vago               โ     โ
โ  โ    GET    /vacant-slots - Detectar horรกrios vagos                  โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ                     SERVICES (Business Logic)                       โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค     โ
โ  โ  NotificationService                                                โ     โ
โ  โ    - scheduleClassReminder()                                        โ     โ
โ  โ    - processPendingNotifications()                                  โ     โ
โ  โ    - sendNotification() [Twilio/Simulaรงรฃo]                          โ     โ
โ  โ    - calculateScheduledTime()                                       โ     โ
โ  โ    - buildMessage() [Template com variรกveis]                        โ     โ
โ  โ    - generateRemindersForTimetable()                                โ     โ
โ  โ    - cancelRemindersForTimetable()                                  โ     โ
โ  โ                                                                     โ     โ
โ  โ  CalendarAlertsService                                              โ     โ
โ  โ    - checkUpcomingEvents()                                          โ     โ
โ  โ    - notifyNonTeachingDays()                                        โ     โ
โ  โ    - notifyWeeklyEvents()                                           โ     โ
โ  โ    - isTomorrowSchoolDay()                                          โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ                     CRONJOBS (node-cron)                            โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค     โ
โ  โ  ๐ notification.cron.ts                                           โ     โ
โ  โ     Schedule: '* * * * *' (a cada 1 minuto)                        โ     โ
โ  โ     Action: processPendingNotifications()                           โ     โ
โ  โ                                                                     โ     โ
โ  โ  ๐ calendar.alerts.cron.ts                                        โ     โ
โ  โ     Schedule 1: '0 20 * * *' (diรกrio รs 20:00)                     โ     โ
โ  โ     Action: checkUpcomingEvents(1 dia)                              โ     โ
โ  โ                                                                     โ     โ
โ  โ     Schedule 2: '0 6 * * *' (diรกrio รs 06:00)                      โ     โ
โ  โ     Action: notifyNonTeachingDays()                                 โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโ MONGODB ATLAS (Mongoose) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ                โ
โ  โ  Notification  โ  โNotificationConfโ  โGeneratedTimeTabโ                โ
โ  โโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโโโค                โ
โ  โ userId         โ  โ userId (unique)โ  โ userId         โ                โ
โ  โ type           โ  โ reminderEnabledโ  โ scheduleId     โ                โ
โ  โ recipientType  โ  โ reminderMinutesโ  โ classId        โ                โ
โ  โ recipientId    โ  โ messageTemplateโ  โ slots[]        โ                โ
โ  โ recipientPhone โ  โ sendToWhatsApp โ  โ  - period      โ                โ
โ  โ message        โ  โ sendToSMS      โ  โ  - day         โ                โ
โ  โ status         โ  โ twilioSid      โ  โ  - teacherId   โ                โ
โ  โ scheduledFor   โ  โ twilioToken    โ  โ  - subjectId   โ                โ
โ  โ sentAt         โ  โ twilioPhone    โ  โ  - startTime โ โ                โ
โ  โ metadata       โ  โโโโโโโโโโโโโโโโโโ  โ  - endTime โ   โ                โ
โ  โ createdAt      โ                      โ  - className   โ                โ
โ  โโโโโโโโโโโโโโโโโโ                      โโโโโโโโโโโโโโโโโโ                โ
โ                                                                               โ
โ  รndices Otimizados:                                                          โ
โ  - Notification: status+scheduledFor, recipientId+createdAt, userId+createdAtโ
โ  - NotificationConfig: userId (unique)                                        โ
โ                                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโ INTEGRAรรES EXTERNAS โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ  ๐ฑ TWILIO API (Opcional)                                          โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค     โ
โ  โ  - SMS: ~$0.0075/mensagem (Brasil)                                 โ     โ
โ  โ  - WhatsApp: ~$0.005/mensagem (Brasil)                             โ     โ
โ  โ  - Nรบmero: ~$1/mรชs (Brasil)                                        โ     โ
โ  โ                                                                     โ     โ
โ  โ  Status Atual: SIMULADO (console.log)                              โ     โ
โ  โ  Para ativar: Configurar credenciais em /notifications             โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              FLUXOS DE DADOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FLUXO 1: NOTIFICAรรES AUTOMรTICAS (Lembretes de Aula)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. USUรRIO                                2. BACKEND                         
   โโโโโโโโโโโโ                             โโโโโโโโโโโโ                      
   โGera      โ                             โSchedule  โ                      
   โHorรกrio   โ โโโโโPOSTโโโโโโโโโโโโโโโโโโถ โReminders โ                      
   โ /timetableโ                             โ          โ                      
   โโโโโโโโโโโโ                             โโโโโโโฌโโโโโ                      
                                                  โ                           
                                                  โผ                           
                                           โโโโโโโโโโโโโโโโ                   
                                           โNotification  โ                   
                                           โModel         โ                   
                                           โstatus=pendingโ                   
                                           โscheduledFor= โ                   
                                           โ  dataAula -  โ                   
                                           โ  15 minutes  โ                   
                                           โโโโโโโโฌโโโโโโโโ                   
                                                  โ                           
                     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                           
                     โ                                                        
                     โผ                                                        
3. CRONJOB (a cada 1 minuto)                                                  
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                    
   โ find({                              โ                                    
   โ   status: 'pending',                โ                                    
   โ   scheduledFor: { $lte: new Date() }โ                                    
   โ })                                  โ                                    
   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ                                    
                โ                                                             
                โผ                                                             
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                    
   โ Para cada notificaรงรฃo:              โ                                    
   โ   - Enviar via Twilio/Simulaรงรฃo     โ                                    
   โ   - status = 'sent' ou 'failed'     โ                                    
   โ   - sentAt = new Date()             โ                                    
   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ                                    
                โ                                                             
                โผ                                                             
4. PROFESSOR                                                                  
   โโโโโโโโโโโโ                                                               
   โRecebe SMSโ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 
   โ/WhatsApp โ                                                             โ 
   โ          โ  "๐ Lembrete de Aula                                       โ 
   โ          โ   ๐ Disciplina: Matemรกtica                                 โ 
   โ          โ   ๐ Turma: 1ยบ Ano A                                        โ 
   โ          โ   ๐ Dia: Segunda-feira                                     โ 
   โ          โ   โฐ Horรกrio: 07:00 - 07:50"                                โ 
   โโโโโโโโโโโโ                                                             โ 
                                                                             โ 

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FLUXO 2: MENSAGENS INSTANTรNEAS                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. COORDENADOR                           2. BACKEND                          
   โโโโโโโโโโโโ                             โโโโโโโโโโโโ                      
   โAcessa    โ                             โPOST      โ                      
   โ/live-    โ                             โ/live-    โ                      
   โmessages  โ                             โmessages  โ                      
   โโโโโโฌโโโโโโ                             โ/send     โ                      
        โ                                   โโโโโโฌโโโโโโ                      
        โผ                                        โ                            
   โโโโโโโโโโโโโโโโโโโ                           โผ                            
   โSeleciona:       โ         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               
   โ- Professores OU โโโโโโโโโโถโPara cada destinatรกrio:      โ               
   โ- "Enviar Todos" โ         โ  Criar Notification:        โ               
   โ                 โ         โ    scheduledFor = now       โ               
   โDigita mensagem  โ         โ    status = 'pending'       โ               
   โou usa template  โ         โ    message = texto completo โ               
   โ                 โ         โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ               
   โClica "Enviar"   โ                        โ                              
   โโโโโโโโโโโโโโโโโโโ                        โผ                              
                                    โโโโโโโโโโโโโโโโโโโโ                     
                     โโโโโโโโโโโโโโโโCronjob detecta   โ                     
                     โ              โimediatamente     โ                     
                     โ              โ(scheduledFor โคnow)โ                     
                     โ              โโโโโโโโโโโโโโโโโโโโ                     
                     โผ                                                        
3. PROFESSOR                                                                  
   โโโโโโโโโโโโ                                                               
   โRecebe    โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 
   โURGENTE   โ                                                             โ 
   โ< 5 seg   โ  "๐จ REUNIรO URGENTE                                        โ 
   โ          โ   ๐ Hoje รs 15:00                                          โ 
   โ          โ   ๐ Sala de Reuniรตes                                       โ 
   โ          โ   โ๏ธ Presenรงa obrigatรณria"                                  โ 
   โโโโโโโโโโโโ                                                             โ 


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FLUXO 3: HORรRIO EMERGENCIAL                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. COORDENADOR                           2. SISTEMA                          
   โโโโโโโโโโโโ                             โโโโโโโโโโโโ                      
   โAcessa    โ                             โBusca     โ                      
   โ/emergencyโ                             โhorรกrio   โ                      
   โ-schedule โ                             โnormal da โ                      
   โโโโโโฌโโโโโโ                             โturma     โ                      
        โ                                   โโโโโโฌโโโโโโ                      
        โผ                                        โ                            
   โโโโโโโโโโโโโโโโโโโ                           โผ                            
   โSeleciona:       โ         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               
   โ- Data           โโโโโโโโโโถโIdentifica aulas do professorโ               
   โ- Turma          โ         โausente                      โ               
   โ- Prof. Ausente  โ         โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ               
   โ- Motivo         โ                        โ                              
   โ                 โ                        โผ                              
   โGera Horรกrio     โ         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               
   โโโโโโฌโโโโโโโโโโโโโ         โSugere substitutos:          โ               
        โ                      โ- Mesma disciplina           โ               
        โ                      โ- Horรกrio livre              โ               
        โ                      โ- Professor ativo            โ               
        โ                      โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ               
        โผ                                     โ                              
   โโโโโโโโโโโโโโโโโโโ                        โผ                              
   โRevisa tabela    โ         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               
   โde substituiรงรตes โ         โExibe tabela com:            โ               
   โ                 โ         โ- Horรกrio | Disciplina       โ               
   โClica "Notificar"โโโโโโโโโโถโ- Prof. Substituto | Aรงรตes  โ               
   โTodos Envolvidos"โ         โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ               
   โโโโโโโโโโโโโโโโโโโ                        โ                              
                                              โผ                              
3. PROFESSORES SUBSTITUTOS                                                    
   โโโโโโโโโโโโ                                                               
   โRecebem   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 
   โnotificaรงรฃoโ                                                             โ 
   โ           โ  "โก SUBSTITUIรรO DE EMERGรNCIA                             โ 
   โ           โ   ๐ Data: 22/12/2024                                       โ 
   โ           โ   ๐ Turma: 2ยบ Ano B                                        โ 
   โ           โ   ๐จโ๐ซ Professor ausente: Joรฃo Silva                         โ 
   โ           โ   โน๏ธ Motivo: Doenรงa                                         โ 
   โ           โ                                                             โ 
   โ           โ   Suas aulas de hoje:                                       โ 
   โ           โ   1ยบ horรกrio (07:00-07:50) - Matemรกtica                     โ 
   โ           โ   3ยบ horรกrio (08:40-09:30) - Fรญsica"                        โ 
   โโโโโโโโโโโโ                                                             โ 


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          CรDIGO DE CORES (STATUS)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

NOTIFICAรรES:
  โช Cinza     - Pendente (aguardando horรกrio de envio)
  ๐ข Verde     - Enviada com sucesso
  ๐ด Vermelho  - Falha no envio
  ๐ก Amarelo   - Cancelada pelo usuรกrio

DISPLAY PANEL (TV):
  ๐ข Verde     - Aula EM ANDAMENTO (horรกrio atual)
  ๐ก Amarelo   - Prรณxima aula (menos de 30 minutos)
  ๐ต Azul      - Aulas futuras (mais de 30 minutos)
  โซ Cinza     - Aulas concluรญdas (passadas)

MENU:
  ๐ก Amarelo   - Notificaรงรตes e Lembretes
  ๐ข Verde     - Mensagens ao Vivo (URGENTE)
  ๐ด Vermelho  - Horรกrio Emergencial (URGENTE)
  ๐ฃ Roxo      - Painel de Avisos (TV)


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        ESTATรSTICAS DE IMPLEMENTAรรO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

TEMPO DE DESENVOLVIMENTO: ~8 horas
LINHAS DE CรDIGO: ~5.800 linhas
ARQUIVOS CRIADOS: 21 arquivos
ENDPOINTS API: 10 rotas
COMPONENTES FRONTEND: 4 pรกginas
MODELOS BANCO: 2 novos + 1 modificado
CRONJOBS: 3 tarefas automรกticas

TECNOLOGIAS:
  Backend: Node.js, Express, TypeScript, Mongoose, node-cron
  Frontend: React 18, TypeScript, Vite, TanStack Query
  Banco: MongoDB Atlas
  Integraรงรตes: Twilio API (opcional)

STATUS: โ FUNCIONAL E PRONTO PARA TESTES


ยฉ 2025 Wander Pires Silva Coelho - Todos os direitos reservados
